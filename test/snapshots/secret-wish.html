    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <form action="" method="post" novalidate>

                    <h1 class="govuk-label-wrapper">
  <label class="govuk-label govuk-label--l" for="secretWish">
    Share a secret wish for your holiday (will be redacted).
  </label>
</h1>




                <h2 class="govuk-heading-m">Redaction preview</h2>

                <details id="secretWish-unredacted" class="govuk-details" data-original="">
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text">
      Original
    </span>
  </summary>
  <div class="govuk-details__text">
    
  </div>
</details>


                <div class="govuk-form-group">
  <label class="govuk-label" for="secretWish">
    Secret wish
  </label>
  <textarea class="govuk-textarea" id="secretWish" name="secretWish" rows="8" readonly="true"></textarea>
</div>


                <div class="govuk-button-group">
                    <button type="button" class="govuk-button govuk-button--secondary" data-module="govuk-button" id="redact-selected-text">
  Redact selected text
</button>

                    <button type="button" class="govuk-button govuk-button--secondary" data-module="govuk-button" id="redact-undo">
  Undo
</button>

                    <button type="button" class="govuk-button govuk-button--secondary" data-module="govuk-button" id="redact-undo-all">
  Undo all changes
</button>
                </div>

                <button type="submit" class="govuk-button" data-module="govuk-button" data-cy="button-save-and-continue">
  Continue
</button>
            </form>
        </div>

        <script >
          /**
           * @param {HTMLTextAreaElement} textArea
           * @param {HTMLButtonElement} redactSelectedText
           * @param {HTMLButtonElement} redactUndo
           * @param {HTMLButtonElement} redactUndoAll
           * @param {HTMLDetailsElement} unredactedText
           * @param {HTMLAnchorElement[]} rejectLinks
           * @param {import('@azure/ai-text-analytics').PiiEntity[]} suggestions
           */
          function registerEventListeners({textArea, redactSelectedText, redactUndo, redactUndoAll, unredactedText, rejectLinks, suggestions}) {
            const formGroup = textArea.parentElement;
            const errorMessage = document.createElement('p');
            errorMessage.id = 'secretWish-error';
            errorMessage.classList.add('govuk-error-message');

            const history = [];
            function showError(message) {
              formGroup.classList.add('govuk-form-group--error');
              errorMessage.textContent = message;
              formGroup.prepend(errorMessage);
            }
            function hideError() {
              textArea.parentElement.classList.remove('govuk-form-group--error');
              errorMessage.remove();
            }
            redactSelectedText.addEventListener('click', () => {
              const { selectionStart, selectionEnd } = textArea;
              if (selectionStart === selectionEnd) {
                // no selected text
                showError('Select text to redact');
                return;
              }
              hideError();
              // replace the text with the 'full block' █ character
              const selectedText = textArea.value.substring(selectionStart, selectionEnd);
              const redactedText = '█'.repeat(selectionEnd - selectionStart);
              textArea.value = textArea.value.substring(0, selectionStart) + redactedText + textArea.value.substring(selectionEnd);
              // add to history for undo functionality
              history.push({
                selectionStart,
                selectionEnd,
                selectedText
              });
            });
            redactUndo.addEventListener('click', () => {
              const { selectionStart, selectionEnd, selectedText } = history.pop() || {};
              if (selectionStart !== undefined && selectionEnd !== undefined && selectedText) {
                hideError();
                textArea.value = textArea.value.substring(0, selectionStart) + selectedText + textArea.value.substring(selectionEnd);
              } else {
                showError('No changes to undo');
              }
            });
            redactUndoAll.addEventListener('click', () => {
              const unredated = unredactedText.dataset.original;
              if (history.length === 0 && textArea.value === unredated) {
                showError('No changes to undo');
                return;
              }
              hideError();
              textArea.value = unredated || '';
              history.length = 0;
            });
            for (const rejectLink of rejectLinks) {
              rejectLink.addEventListener('click', () => {
                const index = parseInt(rejectLink.getAttribute('data-redact').replace('suggestion-reject-', ''));
                const suggestion = suggestions[index];
                if (rejectLink.text === 'Reject') {
                  textArea.value = textArea.value.substring(0, suggestion.offset) + suggestion.text + textArea.value.substring(suggestion.offset + suggestion.length);
                  rejectLink.text = 'Accept';
                } else {
                  const redactedText = '█'.repeat(suggestion.length);
                  textArea.value = textArea.value.substring(0, suggestion.offset) + redactedText+ textArea.value.substring(suggestion.offset + suggestion.length);
                  rejectLink.text = 'Reject';
                }
              });
            }
          }

          function initRedact() {
            const textArea = document.querySelector('#secretWish');
            const redactSelectedText = document.querySelector('#redact-selected-text');
            const redactUndo = document.querySelector('#redact-undo');
            const redactUndoAll = document.querySelector('#redact-undo-all');
            const unredactedText = document.querySelector('#secretWish-unredacted');
            const rejectLinks = document.querySelectorAll('[data-redact]');
            const suggestions = []

            if (!textArea || !(textArea instanceof HTMLTextAreaElement)) {
              return;
            }
            if (!redactSelectedText || !(redactSelectedText instanceof HTMLButtonElement)) {
              return;
            }
            if (!redactUndo || !(redactUndo instanceof HTMLButtonElement)) {
              return;
            }
            if (!redactUndoAll || !(redactUndoAll instanceof HTMLButtonElement)) {
              return;
            }
            if (!unredactedText || !(unredactedText instanceof HTMLDetailsElement)) {
              return;
            }

            registerEventListeners({textArea, redactSelectedText, redactUndo, redactUndoAll, unredactedText, rejectLinks, suggestions});
          }

          initRedact();
        </script>
    </div>
